{% extends 'homepage/base.html' %}
{% load static %}

{% block title %}Busca de Not√≠cias | InfoTrack{% endblock %}

{% block content %}

<section class="banner-home fade-in" style="padding: 50px 0; border-bottom: 1px solid #eee;">
  <div class="container texto-banner">
    <h1>Busque Not√≠cias</h1>
    <p>Encontre as √∫ltimas atualiza√ß√µes em diversas categorias</p>

    <form method="get" action="{% url 'filtragem' %}" class="form-busca">
      <div class="inputs-busca">
        <select name="categoria">
          <option value="">Todas as categorias</option>
          <option value="business" {% if categoria == "business" %}selected{% endif %}>Neg√≥cios</option>
          <option value="entertainment" {% if categoria == "entertainment" %}selected{% endif %}>Entretenimento</option>
          <option value="health" {% if categoria == "health" %}selected{% endif %}>Sa√∫de</option>
          <option value="science" {% if categoria == "science" %}selected{% endif %}>Ci√™ncia</option>
          <option value="sports" {% if categoria == "sports" %}selected{% endif %}>Esportes</option>
          <option value="technology" {% if categoria == "technology" %}selected{% endif %}>Tecnologia</option>
        </select>

        <input
        type="date"
        name="data_inicio"
        value="{{ data_inicio }}"
        style="flex: 0.7"
        />

        <input
          type="date"
          name="data_fim"
          value="{{ data_fim }}"
          style="flex: 0.7"
        />
      
        <input
          type="search"
          name="pesquisa"
          placeholder="Buscar palavra-chave..."
          value="{{ pesquisa }}"
        />
      </div>
      <button type="submit" class="botao-buscar">
        <i class="fa-solid fa-magnifying-glass"></i> Filtrar Not√≠cias
      </button>
    </form>
  </div>
</section>

<!-- ===== RESULTADOS ===== -->
<section class="destaques fade-in">
  <div class="container">
    {% if page_obj.object_list %}
      <h2>Foram encontradas {{ total_noticias }} not√≠cias</h2>
      <div class="cards-destaque">
        {% for n in page_obj %}
          <article class="card">
            {% if n.urlToImage %}
              <img src="{{ n.urlToImage }}" alt="Imagem da not√≠cia">
            {% else %}
              <img src="{% static 'homepage/img/noticia1.webp' %}" alt="Imagem padr√£o">
            {% endif %}
            <h3>{{ n.title|truncatechars:120 }}</h3>
            <p style="padding: 0 15px; font-size: 0.9rem; color: #555;">
              {{ n.description|default:"Sem descri√ß√£o dispon√≠vel."|truncatechars:150 }}
            </p>
            <p style="padding: 0 15px; font-size: 0.8rem; color: #999;">
              <small><strong>{{ n.source.name }}</strong> ‚Äî {{ n.publishedAt|date:"d/m/Y H:i" }}</small>
            </p>
            <a href="{{ n.url }}" target="_blank">Ler mais</a>
          </article>
        {% endfor %}
      </div>

      <!-- PAGINA√á√ÉO -->
      <div class="paginacao" style="text-align:center; margin-top:40px;">
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}&categoria={{ categoria }}&pesquisa={{ pesquisa }}&data={{ data_noticia }}" class="botao-buscar" style="padding:8px 18px;">‚Üê Anterior</a>
        {% endif %}

        <span style="margin: 0 10px;">P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>

        {% if page_obj.has_next %}
          <a href="?page={{ page_obj.next_page_number }}&categoria={{ categoria }}&pesquisa={{ pesquisa }}&data={{ data_noticia }}" class="botao-buscar" style="padding:8px 18px;">Pr√≥xima ‚Üí</a>
        {% endif %}
      </div>

    {% else %}
      <p style="text-align:center; font-size:1.2rem; color:#666; margin-top:50px;">
        Nenhuma not√≠cia encontrada. Tente mudar os filtros ou buscar outro termo üîç
      </p>
    {% endif %}
  </div>
</section>

{% endblock %}
